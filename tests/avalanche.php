<?php

/**
 * UNIT TEST: avalanche (entry 87943)
 */

$tree = <<<TREE
(ROOT
  (S (`` ``)
    (S
      (NP (PRP It))
      (: ...)
      (S
        (VP
          (VP (VBG picked)
            (PRT (RP up))
            (NP (NNS cars)
              (CC and)
              (NN equipment))
            (SBAR (RB as) (IN though)
              (S
                (NP (PRP they))
                (VP (VBD were)
                  (NP
                    (ADJP (RB so) (JJ many))
                    (JJ snow-draped) (NNS toys))))))
          (, ,)
          (CC and)
          (VP (VBG swallowing)
            (NP (PRP them))
            (PRT (RP up)))))
      (, ,)
      (VP (VBD disappeared)
        (PP (IN like)
          (NP (DT a) (JJ white) (, ,) (JJ broad) (NN monster)))
        (PP (IN into)
          (NP (DT the) (NN ravine)))
        (ADVP (RB below))))
    (. .) ('' '')))

(ROOT
  (S
    (ADVP
      (NP
        (QP (RB Nearly) (CD 100))
        (NNS years))
      (RB ago))
    (, ,)
    (PP (IN on)
      (NP (NNP March) (CD 1) (, ,) (CD 1910)))
    (, ,)
    (NP
      (NP (DT the) (JJS deadliest) (NN avalanche))
      (PP (IN in)
        (NP (NNP United) (NNP States) (NN history))))
    (VP (VBD struck)
      (NP
        (NP (DT the) (JJ small) (NN town))
        (PP (IN of)
          (NP (NNP Wellington) (, ,) (NNP Washington)))))
    (. .)))

(ROOT
  (S
    (NP (JJ Ninety-six) (NNS people))
    (VP (VBD died)
      (SBAR (IN as)
        (S
          (NP
            (NP (DT a) (JJ massive) (NN wall))
            (PP (IN of)
              (NP (NN snow))))
          (VP (VBD struck)
            (NP
              (NP (CD two) (NNP Great) (NNP Northern) (NNS trains))
              (VP (VBN stopped)
                (PP (IN at)
                  (NP (NNP Wellington)))
                (S
                  (VP (TO to)
                    (VP (VB wait)
                      (PP (IN for)
                        (NP (DT the) (NNS tracks)))
                      (S
                        (VP (TO to)
                          (VP (VB be)
                            (VP (VBN cleared))))))))))
            (, ,)
            (S
              (VP
                (VP (VBG rolling)
                  (NP (PRP them))
                  (PP
                    (NP (RB nearly) (CD 1000) (NNS feet))
                    (IN into)
                    (NP (NNP Tye) (NNP Creek))))
                (CC and)
                (VP (VBG burying)
                  (NP (DT the) (NNS victims))
                  (PP (IN under)
                    (NP
                      (NP (JJ huge) (NNS piles))
                      (PP (IN of)
                        (NP
                          (NP (NN snow))
                          (, ,)
                          (NP (NNS trees))
                          (, ,)
                          (CC and)
                          (NP (NN debris)))))))))))))
    (. .)))

(ROOT
  (S
    (NP (RB Later) (DT that) (NN year))
    (, ,)
    (NP
      (NP (DT the) (NN town))
      (PP (IN of)
        (NP (NNP Wellington)))
      (, ,)
      (VP (VBN associated)
        (PP (IN in)
          (NP
            (NP (DT the) (JJ public) (NN mind))
            (PP (IN with)
              (NP (NN death)
                (CC and)
                (NN sorrow))))))
      (, ,))
    (VP (VBD changed)
      (NP (PRP$ its) (NN name))
      (PP (TO to)
        (NP (NNP Tye))))
    (. .)))

(ROOT
  (S
    (S
      (NP (NNS Changes))
      (VP (VBD were)
        (VP (VBN proposed)
          (S
            (VP (TO to)
              (VP (VB make)
                (NP
                  (NP (DT the) (NNP Cascade))
                  (VP (VBG crossing)
                    (ADJP (JJR safer))))))))))
    (, ,)
    (CC and)
    (S
      (ADVP (RB eventually))
      (NP (DT a) (JJ new) (NN tunnel) (NN route))
      (VP (VBD was)
        (VP (VBN completed))))
    (. .)))

(ROOT
  (S
    (S
      (ADVP (RB Now)
        (NP (DT the) (NN town)))
      (NP (PRP itself))
      (VP (VBZ is)
        (NP (DT a) (NN ghost))))
    (: ;)
    (S
      (S
        (SBAR
          (WHADVP (WRB when))
          (S
            (NP (DT the) (JJ new) (NNP Cascade) (NN Tunnel))
            (VP (VBD was)
              (VP (VBN built)))))
        (, ,)
        (NP
          (NP
            (NP (NNP Tye) (POS 's))
            (NNS tracks))
          (CC and)
          (NP (NN station)))
        (VP (VBD were)
          (VP (VBN abandoned))))
      (, ,)
      (CC and)
      (S
        (NP (DT the) (JJ last) (VBG remaining) (NN building))
        (VP (VBD burned)
          (PP (IN in)
            (NP (CD 1930))))))
    (. .)))

(ROOT
  (S
    (NP (DT The) (JJ original) (, ,) (JJ abandoned) (NN Cascade) (NN Tunnel))
    (VP (VBZ is)
      (ADVP (RB now))
      (NP (DT the) (NNP Iron) (NNP Goat) (NNP Trail)))
    (. .)))

(ROOT
  (S
    (NP (NNS Photos))
    (VP (VBD related)
      (PP (TO to)
        (NP (DT the) (NNP Wellington) (NN disaster)))
      (PP (IN at)
        (NP (DT the) (NNP Washington) (NNP State) (NNP Historical) (NNP Society)))
      (, ,)
      (PP (IN in)
        (NP (DT the) (NNP Asahel) (NNP Curtis) (NN collection))))
    (. .)))

(ROOT
  (S
    (VP
      (ADVP (RBR More)
        (NP (CD 1910) (NNS photos))))
    (. .)))

(ROOT
  (NP
    (NP (NNS Photos))
    (PP (IN of)
      (NP (DT the) (NN area) (NN today)))
    (. .)))

(ROOT
  (NP
    (NP (DT The) (NN story))
    (PP (IN of)
      (NP
        (NP (DT the) (`` ``) (JJ Great) (NN Slide) ('' ''))
        (PP (IN by)
          (NP
            (NP (DT a) (NN railroad) (NN man))
            (SBAR
              (WHNP (WP who))
              (S
                (VP (VBD was)
                  (PP (IN at)
                    (NP (DT the) (NN scene))))))))))
    (. .)))

(ROOT
  (NP
    (NP (NNP Contemporary))
    (NP (NN news) (NNS stories))
    (. .)))
TREE;

$text = "deadliest avalanche in United States history";
$results = doParse($tree, $text);
test_assert($results["constituency"] === "not_constituent", "The avalanche NP should not be a constituent.");
test_assert($results["failure_type"] === "missing_before", "Should fail by 'missing_before'");
test_assert($results["missing_node"] === "DT", "Should be missing a DT");

$text = "the deadliest avalanche in United States history";
$results = doParse($tree, $text);
test_assert($results["constituency"] === "constituent", "The avalanche DP should be a constituent.");

$text = "Changes were proposed to make the Cascade crossing safer";
$results = doParse($tree, $text);
test_assert($results["constituency"] === "constituent", "Changes S should be a constituent");

$text = "Iron Goat Trail";
$results = doParse($tree, $text);
test_assert($results["constituency"] === "multiple_constituents", "Iron Goat Trail is not a constituent.");
test_assert($results["failure_type"] === "missing_before", "Should fail by 'missing_before'");
test_assert($results["missing_node"] === "DT", "Should be missing a DT");
